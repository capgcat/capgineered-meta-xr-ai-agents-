sources:
  bigquery_connection:
    kind: "bigquery"
    project: "secpatch-460620"

tools:
  insert_device_reading_tool:
    kind: bigquery-sql
    source: bigquery_connection
    description: |
      Inserts a device reading record into the device_readings.realtime table.
      For optional fields not provided, the calling agent should pass NULL.
    parameters:
      - name: time_series_id
        type: string
        description: "Identifier for the time series (e.g., device ID)."
      - name: ts # Renamed from 'timestamp' to avoid SQL keyword conflicts
        type: string
        description: "The timestamp of the reading."
      - name: target_value
        type: float
        description: "The target value measured by the device."
      - name: temperature_unit
        type: string
        description: "Unit of temperature (e.g., Celsius, Fahrenheit). Optional."
      - name: humidity
        type: float
        description: "Humidity reading. Optional."
      - name: battery_level
        type: float
        description: "Battery level of the device. Optional."
      - name: location
        type: string
        description: "Location of the device. Optional."
      - name: status
        type: string
        description: "Status of the device. Optional."
      - name: received_at
        type: string
        description: "Timestamp when the record was received by the system. Optional."
      - name: metadata # Assuming MCP 'json' type maps to BQ JSON
        type: string # Changed from 'json' to 'string'
        description: "Additional metadata as a JSON formatted string. Optional."
      - name: image_url # Assuming MCP 'image' type maps to BQ STRING
        type: string # Changed from 'image' to 'string'
        description: "URL of the image associated with the reading. Optional."
      - name: image_desc_generation_output # Assuming MCP 'text' type maps to BQ STRING
        type: string # Changed from 'text' to 'string'
        description: "Generated description of the image. Optional."
    statement: |
      INSERT INTO `secpatch-460620.device_readings.realtime` (
        time_series_id, timestamp, target_value, temperature_unit,
        humidity, battery_level, location, status, received_at, metadata,
        image_desc_generation_output, image_url
      ) VALUES (
        @time_series_id, @ts, @target_value, @temperature_unit, @humidity,
        @battery_level, @location, @status, @received_at, PARSE_JSON(@metadata),
        @image_desc_generation_output, @image_url
      );

toolsets:
  iot_device_toolset: # Optional: grouping the new tool
    - insert_device_reading_tool
